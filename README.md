# Cupid - ç›¸æ€ç›¸æ„›ãƒãƒƒãƒãƒ³ã‚°LINE Bot

[![Go Version](https://img.shields.io/badge/Go-1.25.5-00ADD8?logo=go)](https://go.dev/)
[![License](https://img.shields.io/badge/License-MIT-blue.svg)](LICENSE)
[![Status](https://img.shields.io/badge/Status-Production-success)](https://cupid-linebot.click/)

**Cupid**ã¯ã€ç›¸æ€ç›¸æ„›ã‚’è¦‹ã¤ã‘ã‚‹ãŸã‚ã®LINE Botã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã€‚è‡ªåˆ†ã¨å¥½ããªäººã®æƒ…å ±ã‚’ç™»éŒ²ã™ã‚‹ã¨ã€ç›¸æ‰‹ã‚‚è‡ªåˆ†ã‚’ç™»éŒ²ã—ã¦ã„ã‚‹å ´åˆã®ã¿ã€ä¸¡è€…ã«ãƒãƒƒãƒãƒ³ã‚°é€šçŸ¥ãŒå±Šãã€‚

ğŸ”— **æœ¬ç•ªç’°å¢ƒ**: https://cupid-linebot.click/

---

## ğŸ“– æ¦‚è¦

### ã©ã‚“ãªã‚¢ãƒ—ãƒªï¼Ÿ

- **åŒ¿åæ€§**: ç›¸æ€ç›¸æ„›ã§ãªã„é™ã‚Šã€ç›¸æ‰‹ã«æƒ…å ±ã¯ä¼ã‚ã‚‰ãªã„
- **ã‚·ãƒ³ãƒ—ãƒ«**: LINEä¸Šã§åå‰ã¨èª•ç”Ÿæ—¥ã‚’ç™»éŒ²ã™ã‚‹ã ã‘
- **ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ä¿è­·**: ä¸€æ–¹çš„ãªå¥½æ„ã¯ç›¸æ‰‹ã«é€šçŸ¥ã•ã‚Œãªã„

### ä¸»ãªæ©Ÿèƒ½

1. **ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²**: è‡ªåˆ†ã®åå‰ã¨èª•ç”Ÿæ—¥ã‚’LIFFçµŒç”±ã§ç™»éŒ²
2. **å¥½ããªäººç™»éŒ²**: å¥½ããªäººã®åå‰ã¨èª•ç”Ÿæ—¥ã‚’ç™»éŒ²
3. **è‡ªå‹•ãƒãƒƒãƒãƒ³ã‚°**: ç›¸æ€ç›¸æ„›ã®å ´åˆã®ã¿ä¸¡è€…ã«é€šçŸ¥
4. **æƒ…å ±æ›´æ–°**: ç™»éŒ²æƒ…å ±ã®å¤‰æ›´ãŒå¯èƒ½
5. **ãƒãƒƒãƒãƒ³ã‚°è§£é™¤**: æƒ…å ±å¤‰æ›´æ™‚ã«æ—¢å­˜ãƒãƒƒãƒãƒ³ã‚°ã‚’è§£é™¤

---

## ğŸ¯ ä½¿ã„æ–¹ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼è¦–ç‚¹ï¼‰

### 1. LINE Botã‚’å‹é”è¿½åŠ 

QRã‚³ãƒ¼ãƒ‰ã¾ãŸã¯æ¤œç´¢ã§Cupid LINE Botã‚’å‹é”è¿½åŠ ã€‚

### 2. è‡ªåˆ†ã®æƒ…å ±ã‚’ç™»éŒ²

ãƒˆãƒ¼ã‚¯ç”»é¢ã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ã‚‹ã¨ã€ç™»éŒ²ç”¨ã®LIFF URLãŒé€ã‚‰ã‚Œã¦ãã‚‹ã€‚

```
ã€å…¥åŠ›å†…å®¹ã€‘
- åå‰ï¼ˆå…¨è§’ã‚«ã‚¿ã‚«ãƒŠã€ç©ºç™½ãªã—ï¼‰
- èª•ç”Ÿæ—¥ï¼ˆYYYY-MM-DDå½¢å¼ï¼‰
```

### 3. å¥½ããªäººã‚’ç™»éŒ²

ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²å®Œäº†å¾Œã€å¥½ããªäººã®ç™»éŒ²ç”¨URLãŒé€ã‚‰ã‚Œã¦ãã‚‹ã€‚

```
ã€å…¥åŠ›å†…å®¹ã€‘
- å¥½ããªäººã®åå‰ï¼ˆå…¨è§’ã‚«ã‚¿ã‚«ãƒŠã€ç©ºç™½ãªã—ï¼‰
- å¥½ããªäººã®èª•ç”Ÿæ—¥ï¼ˆYYYY-MM-DDå½¢å¼ï¼‰
```

### 4. ãƒãƒƒãƒãƒ³ã‚°é€šçŸ¥

ç›¸æ‰‹ã‚‚è‡ªåˆ†ã‚’ç™»éŒ²ã—ã¦ã„ã‚‹å ´åˆã€ä¸¡è€…ã«ãƒãƒƒãƒãƒ³ã‚°é€šçŸ¥ãŒå±Šãã€‚

```
ğŸ‰ ç›¸æ€ç›¸æ„›ãŒæˆç«‹ã—ã¾ã—ãŸï¼
ç›¸æ‰‹ï¼šâ—‹â—‹ã•ã‚“
```

### 5. æƒ…å ±å¤‰æ›´

ãƒˆãƒ¼ã‚¯ç”»é¢ã‹ã‚‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ã‚‹ã¨ã€å†ç™»éŒ²ç”¨URLãŒé€ã‚‰ã‚Œã¦ãã‚‹ã€‚

**æ³¨æ„**: ãƒãƒƒãƒãƒ³ã‚°ä¸­ã«æƒ…å ±ã‚’å¤‰æ›´ã™ã‚‹ã¨ã€ãƒãƒƒãƒãƒ³ã‚°ãŒè§£é™¤ã•ã‚Œã‚‹ã€‚

---

## ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ

```
[LINE Platform]
       â†“ Webhook
[Nginx (HTTPS)] â† Let's Encrypt
       â†“
[Cupid Go Server :8080]
       â†“
[SQLite Database]
```

### æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

| é …ç›® | æŠ€è¡“ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ |
|-----|------|----------|
| **è¨€èª** | Go | 1.25.5 |
| **ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯** | net/http (æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒª) | - |
| **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹** | SQLite | 3 |
| **ORM** | SQLBoiler | latest |
| **ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³** | sql-migrate | latest |
| **LINE SDK** | line-bot-sdk-go | v8 |
| **Webã‚µãƒ¼ãƒãƒ¼** | Nginx | 1.24.0 |
| **SSL/TLS** | Let's Encrypt (Certbot) | - |
| **ã‚¤ãƒ³ãƒ•ãƒ©** | AWS EC2 (t4g.micro, ARM64) | Amazon Linux 2023 |
| **ãƒ‰ãƒ¡ã‚¤ãƒ³** | AWS Route 53 | cupid-linebot.click |

### ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

```
cupid/
â”œâ”€â”€ cmd/
â”‚   â””â”€â”€ server/
â”‚       â””â”€â”€ main.go              # ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ handler/                 # HTTPãƒãƒ³ãƒ‰ãƒ©ãƒ¼
â”‚   â”‚   â”œâ”€â”€ webhook.go           # LINE Webhook
â”‚   â”‚   â”œâ”€â”€ registration_api.go  # ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²API
â”‚   â”‚   â””â”€â”€ crush_registration_api.go # å¥½ããªäººç™»éŒ²API
â”‚   â”œâ”€â”€ service/                 # ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
â”‚   â”‚   â”œâ”€â”€ user_service.go      # ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†
â”‚   â”‚   â””â”€â”€ matching_service.go  # ãƒãƒƒãƒãƒ³ã‚°å‡¦ç†
â”‚   â”œâ”€â”€ repository/              # ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹
â”‚   â”‚   â””â”€â”€ user_repo.go
â”‚   â”œâ”€â”€ model/                   # ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«
â”‚   â”‚   â””â”€â”€ user.go
â”‚   â”œâ”€â”€ liff/                    # LIFFèªè¨¼
â”‚   â”œâ”€â”€ linebot/                 # LINE Bot Client
â”‚   â””â”€â”€ database/                # DBæ¥ç¶š
â”œâ”€â”€ entities/                    # SQLBoilerè‡ªå‹•ç”Ÿæˆ
â”œâ”€â”€ db/
â”‚   â”œâ”€â”€ migrations/              # SQLãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
â”‚   â””â”€â”€ dbconfig.yml
â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ liff/                    # ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²LIFF
â”‚   â””â”€â”€ crush/                   # å¥½ããªäººç™»éŒ²LIFF
â”œâ”€â”€ e2e/                         # E2Eãƒ†ã‚¹ãƒˆ
â””â”€â”€ docs/
    â””â”€â”€ plans/                   # è¨­è¨ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
```

---

## ğŸ—„ï¸ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒ

### users ãƒ†ãƒ¼ãƒ–ãƒ«

ç›¸æ€ç›¸æ„›ãƒãƒƒãƒãƒ³ã‚°ã®å…¨æƒ…å ±ã‚’ç®¡ç†ã€‚

```sql
CREATE TABLE users (
  line_user_id TEXT PRIMARY KEY,
  name TEXT NOT NULL,
  birthday TEXT NOT NULL,
  registration_step INTEGER NOT NULL DEFAULT 1,
  crush_name TEXT,
  crush_birthday TEXT,
  matched_with_user_id TEXT,
  registered_at TEXT NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at TEXT NOT NULL DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (matched_with_user_id) REFERENCES users(line_user_id)
);

CREATE INDEX idx_users_name_birthday ON users(name, birthday);
CREATE INDEX idx_users_crush ON users(crush_name, crush_birthday);
```

#### ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰èª¬æ˜

| ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | å‹ | èª¬æ˜ |
|-----------|---|------|
| `line_user_id` | TEXT | LINE ãƒ¦ãƒ¼ã‚¶ãƒ¼IDï¼ˆä¸»ã‚­ãƒ¼ï¼‰ |
| `name` | TEXT | ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®åå‰ï¼ˆå…¨è§’ã‚«ã‚¿ã‚«ãƒŠï¼‰ |
| `birthday` | TEXT | èª•ç”Ÿæ—¥ï¼ˆYYYY-MM-DDï¼‰ |
| `registration_step` | INTEGER | ç™»éŒ²ã‚¹ãƒ†ãƒƒãƒ—ï¼ˆ1: ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²å®Œäº†, 2: å¥½ããªäººç™»éŒ²å®Œäº†ï¼‰ |
| `crush_name` | TEXT | å¥½ããªäººã®åå‰ï¼ˆNULLå¯ï¼‰ |
| `crush_birthday` | TEXT | å¥½ããªäººã®èª•ç”Ÿæ—¥ï¼ˆNULLå¯ï¼‰ |
| `matched_with_user_id` | TEXT | ãƒãƒƒãƒãƒ³ã‚°ç›¸æ‰‹ã®LINE IDï¼ˆNULL=æœªãƒãƒƒãƒï¼‰ |
| `registered_at` | TEXT | ç™»éŒ²æ—¥æ™‚ |
| `updated_at` | TEXT | æ›´æ–°æ—¥æ™‚ï¼ˆè‡ªå‹•æ›´æ–°ï¼‰ |

#### è¨­è¨ˆæ€æƒ³

- **YAGNIåŸå‰‡**: 1äººã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯1äººã®å¥½ããªäººã®ã¿ç™»éŒ²å¯èƒ½
- **ã‚·ãƒ³ãƒ—ãƒ«è¨­è¨ˆ**: likesãƒ†ãƒ¼ãƒ–ãƒ«ã‚’å»ƒæ­¢ã—ã€usersãƒ†ãƒ¼ãƒ–ãƒ«ã«çµ±åˆ
- **ãƒãƒƒãƒãƒ³ã‚°åˆ¤å®š**: `crush_name`/`crush_birthday` ã¨ `name`/`birthday` ã®ç›¸äº’ä¸€è‡´ã§åˆ¤å®š

---

## ğŸ”Œ APIä»•æ§˜

### LINE Webhook

**Endpoint**: `POST /webhook`

LINE Platformã‹ã‚‰ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’å—ä¿¡ã€‚

#### ã‚¤ãƒ™ãƒ³ãƒˆã‚¿ã‚¤ãƒ—

1. **follow**: å‹é”è¿½åŠ æ™‚ã«æŒ¨æ‹¶ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡
2. **message**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«å¿œã˜ã¦ç™»éŒ²URLã‚’æ¡ˆå†…

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²API

**Endpoint**: `POST /api/register`

LIFFçµŒç”±ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’ç™»éŒ²ã€‚

#### ãƒªã‚¯ã‚¨ã‚¹ãƒˆ

```json
{
  "name": "ã‚¿ãƒŠã‚«ã‚¿ãƒ­ã‚¦",
  "birthday": "2000-01-15",
  "confirm_unmatch": false
}
```

#### ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆæˆåŠŸï¼‰

```json
{
  "status": "ok"
}
```

#### ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆãƒãƒƒãƒãƒ³ã‚°ä¸­ï¼‰

```json
{
  "error": "matched_user_exists",
  "message": "ç¾åœ¨ãƒãƒƒãƒãƒ³ã‚°ä¸­ã§ã™ã€‚å¤‰æ›´ã™ã‚‹ã¨ãƒãƒƒãƒãƒ³ã‚°ãŒè§£é™¤ã•ã‚Œã¾ã™ã€‚"
}
```

**HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰**: 409 Conflict

#### èªè¨¼

- `Authorization: Bearer {LIFF_ID_TOKEN}`
- LINE LIFF ID Tokenã‚’æ¤œè¨¼ã—ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚’å–å¾—

### å¥½ããªäººç™»éŒ²API

**Endpoint**: `POST /api/register-crush`

LIFFçµŒç”±ã§å¥½ããªäººã®æƒ…å ±ã‚’ç™»éŒ²ã€‚

#### ãƒªã‚¯ã‚¨ã‚¹ãƒˆ

```json
{
  "crush_name": "ãƒ¤ãƒãƒ€ãƒãƒŠã‚³",
  "crush_birthday": "2000-05-20",
  "confirm_unmatch": false
}
```

#### ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆãƒãƒƒãƒãƒ³ã‚°æˆç«‹ï¼‰

```json
{
  "status": "ok",
  "matched": true,
  "message": "ãƒ¤ãƒãƒ€ãƒãƒŠã‚³ã•ã‚“ã¨ãƒãƒƒãƒã—ã¾ã—ãŸï¼ğŸ’˜"
}
```

#### ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆæœªãƒãƒƒãƒï¼‰

```json
{
  "status": "ok",
  "matched": false,
  "message": "ç™»éŒ²ã—ã¾ã—ãŸã€‚ç›¸æ‰‹ãŒã‚ãªãŸã‚’ç™»éŒ²ã—ãŸã‚‰ãƒãƒƒãƒãƒ³ã‚°ã—ã¾ã™ã€‚"
}
```

#### ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆãƒãƒƒãƒãƒ³ã‚°ä¸­ï¼‰

```json
{
  "error": "matched_user_exists",
  "message": "ç¾åœ¨ãƒãƒƒãƒãƒ³ã‚°ä¸­ã§ã™ã€‚å¤‰æ›´ã™ã‚‹ã¨ãƒãƒƒãƒãƒ³ã‚°ãŒè§£é™¤ã•ã‚Œã¾ã™ã€‚"
}
```

**HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰**: 409 Conflict

---

## ğŸ” ãƒãƒƒãƒãƒ³ã‚°ãƒ­ã‚¸ãƒƒã‚¯

### ãƒãƒƒãƒãƒ³ã‚°åˆ¤å®š

2äººã®ãƒ¦ãƒ¼ã‚¶ãƒ¼A, BãŒä»¥ä¸‹ã®æ¡ä»¶ã‚’æº€ãŸã™å ´åˆã«ãƒãƒƒãƒãƒ³ã‚°æˆç«‹ã€‚

```
A.name == B.crush_name
AND A.birthday == B.crush_birthday
AND B.name == A.crush_name
AND B.birthday == A.crush_birthday
AND B.matched_with_user_id IS NULL
```

### ãƒãƒƒãƒãƒ³ã‚°å‡¦ç†ãƒ•ãƒ­ãƒ¼

1. **å¥½ããªäººç™»éŒ²æ™‚**: `MatchingService.CheckAndUpdateMatch()` ã‚’å®Ÿè¡Œ
2. **ç›¸äº’ãƒãƒƒãƒãƒ³ã‚°æ¤œç´¢**: `UserRepository.FindMatchingUser()` ã§ç›¸æ‰‹ã‚’æ¤œç´¢
3. **ãƒãƒƒãƒãƒ³ã‚°æˆç«‹æ™‚**:
   - ä¸¡è€…ã® `matched_with_user_id` ã‚’æ›´æ–°
   - ä¸¡è€…ã«LINE Pushé€šçŸ¥ã‚’é€ä¿¡

### ãƒãƒƒãƒãƒ³ã‚°è§£é™¤

æƒ…å ±å¤‰æ›´æ™‚ã«ãƒãƒƒãƒãƒ³ã‚°ãŒè§£é™¤ã•ã‚Œã‚‹ã€‚

#### è§£é™¤ãƒˆãƒªã‚¬ãƒ¼

- ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±å¤‰æ›´ï¼ˆåå‰ãƒ»èª•ç”Ÿæ—¥ï¼‰
- å¥½ããªäººå¤‰æ›´

#### è§£é™¤ãƒ•ãƒ­ãƒ¼

1. **ç¢ºèª**: LIFFå´ã§ã€Œãƒãƒƒãƒãƒ³ã‚°ãŒè§£é™¤ã•ã‚Œã¾ã™ã€ã¨ç¢ºèª
2. **ãƒ¦ãƒ¼ã‚¶ãƒ¼æ‰¿èª**: `confirm_unmatch=true` ã§å†é€ä¿¡
3. **è§£é™¤å‡¦ç†**: ä¸¡è€…ã® `matched_with_user_id` ã‚’NULLã«
4. **é€šçŸ¥é€ä¿¡**: ä¸¡è€…ã«è§£é™¤ç†ç”±ã‚’é€šçŸ¥

---

## ğŸ› ï¸ é–‹ç™ºè€…å‘ã‘æƒ…å ±

### ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒ

#### å¿…è¦ãªãƒ„ãƒ¼ãƒ«

- Go 1.25.5+
- SQLite 3
- Make

#### ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

```bash
# ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
go mod download

# ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
make migrate-up

# SQLBoiler entityç”Ÿæˆ
make generate

# ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
make test

# ãƒ­ãƒ¼ã‚«ãƒ«ã‚µãƒ¼ãƒãƒ¼èµ·å‹•
go run ./cmd/server
```

#### ç’°å¢ƒå¤‰æ•°

`.env` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆï¼š

```env
# LINE Botè¨­å®š
LINE_CHANNEL_SECRET=your_channel_secret
LINE_CHANNEL_ACCESS_TOKEN=your_access_token

# LIFFè¨­å®šï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ç”¨ï¼‰
USER_LIFF_CHANNEL_ID=your_user_liff_channel_id
USER_LIFF_URL=your_user_liff_url

# LIFFè¨­å®šï¼ˆå¥½ããªäººç™»éŒ²ç”¨ï¼‰
CRUSH_LIFF_CHANNEL_ID=your_crush_liff_channel_id
CRUSH_LIFF_URL=your_crush_liff_url
```

### ãƒ†ã‚¹ãƒˆ

```bash
# å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
make test

# ã‚«ãƒãƒ¬ãƒƒã‚¸ç¢ºèª
go test -cover ./...

# ç‰¹å®šãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ãƒ†ã‚¹ãƒˆ
go test ./internal/service/...
```

### ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

```bash
# ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é©ç”¨
make migrate-up

# ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯
make migrate-down

# ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³çŠ¶æ…‹ç¢ºèª
make migrate-status

# æ–°è¦ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ä½œæˆ
sql-migrate new -config=db/dbconfig.yml migration_name
```

### ãƒ“ãƒ«ãƒ‰ï¼†ãƒ‡ãƒ—ãƒ­ã‚¤

```bash
# ãƒ­ãƒ¼ã‚«ãƒ«ãƒ“ãƒ«ãƒ‰
go build -o cupid ./cmd/server

# EC2ã¸ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆè‡ªå‹•ï¼‰
make deploy
```

**`make deploy` ã®å‡¦ç†å†…å®¹**:
1. EC2ã«SSHæ¥ç¶š
2. `git pull` ã§æœ€æ–°ã‚³ãƒ¼ãƒ‰å–å¾—
3. `sql-migrate up` ã§ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é©ç”¨
4. `go build` ã§ãƒ“ãƒ«ãƒ‰
5. `sudo systemctl restart cupid` ã§ã‚µãƒ¼ãƒ“ã‚¹å†èµ·å‹•

---

## ğŸš€ æœ¬ç•ªç’°å¢ƒ

### ã‚¤ãƒ³ãƒ•ãƒ©æƒ…å ±

| é …ç›® | å€¤ |
|-----|---|
| **ãƒ‰ãƒ¡ã‚¤ãƒ³** | cupid-linebot.click |
| **ã‚µãƒ¼ãƒãƒ¼** | AWS EC2 t4g.micro (ARM64) |
| **OS** | Amazon Linux 2023 |
| **ãƒªãƒ¼ã‚¸ãƒ§ãƒ³** | ap-northeast-1 (æ±äº¬) |
| **IPã‚¢ãƒ‰ãƒ¬ã‚¹** | 13.115.86.124 (Elastic IP) |
| **SSLè¨¼æ˜æ›¸** | Let's Encryptï¼ˆè‡ªå‹•æ›´æ–°è¨­å®šæ¸ˆã¿ï¼‰ |

### ã‚µãƒ¼ãƒ“ã‚¹ç®¡ç†

```bash
# SSHæ¥ç¶š
ssh cupid-bot

# ã‚µãƒ¼ãƒ“ã‚¹çŠ¶æ…‹ç¢ºèª
sudo systemctl status cupid

# ã‚µãƒ¼ãƒ“ã‚¹å†èµ·å‹•
sudo systemctl restart cupid

# ãƒ­ã‚°ç¢ºèªï¼ˆãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ï¼‰
sudo journalctl -u cupid -f

# ãƒ­ã‚°ç¢ºèªï¼ˆæœ€æ–°100è¡Œï¼‰
sudo journalctl -u cupid -n 100

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç¢ºèª
sqlite3 ~/cupid/cupid.db "SELECT * FROM users;"
```

### ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ•ãƒ­ãƒ¼

1. **ãƒ­ãƒ¼ã‚«ãƒ«ã§é–‹ç™ºï¼†ãƒ†ã‚¹ãƒˆ**
   ```bash
   make test
   git commit -am "feat: add new feature"
   ```

2. **GitHubã«push**
   ```bash
   git push origin main
   ```

3. **æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤**
   ```bash
   make deploy
   ```

### ç›£è¦–

#### ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯

```bash
curl https://cupid-linebot.click/
# => "Cupid LINE Bot is running"
```

#### ãƒ­ã‚°ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°

```bash
# ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã®ã¿è¡¨ç¤º
sudo journalctl -u cupid -p err -n 50

# ç‰¹å®šæ–‡å­—åˆ—ã§æ¤œç´¢
sudo journalctl -u cupid | grep "ERROR"
```

---

## ğŸ“Š é‹ç”¨ã‚³ã‚¹ãƒˆ

| é …ç›® | æœˆé¡ |
|-----|------|
| EC2 t4g.micro | $3.67 |
| Elastic IP | $0.00ï¼ˆç¨¼åƒä¸­ã¯ç„¡æ–™ï¼‰ |
| Route 53 ãƒ›ã‚¹ãƒˆã‚¾ãƒ¼ãƒ³ | $0.50 |
| ãƒ‡ãƒ¼ã‚¿è»¢é€ | $0.00ï¼ˆå°‘é‡ã®ãŸã‚ï¼‰ |
| **åˆè¨ˆ** | **ç´„$4.17/æœˆï¼ˆç´„540å††ï¼‰** |

â€» ãƒ‰ãƒ¡ã‚¤ãƒ³å–å¾—è²»ç”¨: $3/å¹´ï¼ˆ.clickãƒ‰ãƒ¡ã‚¤ãƒ³ï¼‰

---

## ğŸ“ è¨­è¨ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

è©³ç´°ãªè¨­è¨ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ `docs/plans/` ã«æ ¼ç´ã€‚

- **[2026-02-10-likes-migration-design.md](docs/plans/2026-02-10-likes-migration-design.md)**: likesãƒ†ãƒ¼ãƒ–ãƒ«å‰Šé™¤ã¨usersãƒ†ãƒ¼ãƒ–ãƒ«çµ±åˆã®è¨­è¨ˆ
- **[2026-02-10-likes-migration-implementation.md](docs/plans/2026-02-10-likes-migration-implementation.md)**: å®Ÿè£…è¨ˆç”»ï¼ˆ21ã‚¿ã‚¹ã‚¯ï¼‰
- **[2026-02-10-register-from-liff-refactoring-design.md](docs/plans/2026-02-10-register-from-liff-refactoring-design.md)**: RegisterFromLIFFãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°è¨­è¨ˆ

---

## ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

### èªè¨¼ãƒ»èªå¯

- **LIFF ID Tokenæ¤œè¨¼**: LINE Platformç™ºè¡Œã®ID Tokenã‚’æ¤œè¨¼ã—ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚’å–å¾—
- **Webhookç½²åæ¤œè¨¼**: LINE Platformç½²åã‚’æ¤œè¨¼ã—ã¦æ­£å½“æ€§ã‚’ç¢ºèª

### ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ä¿è­·

- **åŒ¿åæ€§**: ç›¸æ€ç›¸æ„›ã§ãªã„é™ã‚Šã€ç›¸æ‰‹ã«æƒ…å ±ã¯é€šçŸ¥ã•ã‚Œãªã„
- **æœ€å°é™ã®ãƒ‡ãƒ¼ã‚¿ä¿å­˜**: åå‰ãƒ»èª•ç”Ÿæ—¥ã®ã¿ä¿å­˜
- **ãƒ‡ãƒ¼ã‚¿æš—å·åŒ–**: HTTPSé€šä¿¡ã§å…¨ãƒ‡ãƒ¼ã‚¿æš—å·åŒ–

---

## ğŸ“œ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

MIT License

---

## ğŸ¤ è²¢çŒ®

Issueãƒ»Pull Requestã‚’æ­“è¿ã—ã¾ã™ã€‚

---

## ğŸ“§ ã‚µãƒãƒ¼ãƒˆ

- **Issue**: [GitHub Issues](https://github.com/morinonusi421/cupid/issues)
- **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**: `docs/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª

---

**Cupid** - ç›¸æ€ç›¸æ„›ã‚’è¦‹ã¤ã‘ã‚‹LINE Bot ğŸ’˜
